(function(c,j,e,l){var f=c.fn.peity=function(h,d){g&&this.each(function(){var k=c(this),m=k.data("_peity");m?(h&&(m.type=h),c.extend(m.opts,d)):(m=new i(k,h,c.extend({},f.defaults[h],k.data("peity"),d)),k.change(function(){m.draw()}).data("_peity",m));m.draw()});return this},i=function(h,d,k){this.$el=h;this.type=d;this.opts=k},b=i.prototype,a=b.svgElement=function(h,d){return c(j.createElementNS("http://www.w3.org/2000/svg",h)).attr(d)},g="createElementNS" in j&&a("svg",{})[0].createSVGRect;b.draw=function(){var d=this.opts;f.graphers[this.type].call(this,d);d.after&&d.after.call(this,d)};b.fill=function(){var d=this.opts.fill;return c.isFunction(d)?d:function(h,k){return d[k%d.length]}};b.prepare=function(h,d){this.$svg||this.$el.hide().after(this.$svg=a("svg",{"class":"peity"}));return this.$svg.empty().data("peity",this).attr({height:d,width:h})};b.values=function(){return c.map(this.$el.text().split(this.opts.delimiter),function(d){return parseFloat(d)})};f.defaults={};f.graphers={};f.register=function(h,d,k){this.defaults[h]=d;this.graphers[h]=k};f.register("pie",{fill:["#ff9900","#fff4dd","#ffc66e"],radius:8},function(E){if(!E.delimiter){var D=this.$el.text().match(/[^0-9\.]/);E.delimiter=D?D[0]:","}D=c.map(this.values(),function(d){return 0<d?d:0});if("/"==E.delimiter){var A=D[0],D=[A,e.max(0,D[1]-A)]}for(var C=0,A=D.length,G=0;C<A;C++){G+=D[C]}G||(A=2,G=1,D=[0,1]);var v=2*E.radius,v=this.prepare(E.width||v,E.height||v),C=v.width(),z=v.height(),w=C/2,B=z/2,z=e.min(w,B),E=E.innerRadius;"donut"==this.type&&!E&&(E=0.5*z);for(var h=e.PI,H=this.fill(),y=this.scale=function(m,d){var n=m/G*h*2-h/2;return[d*e.cos(n)+w,d*e.sin(n)+B]},q=0,C=0;C<A;C++){var F=D[C],x=F/G;if(0!=x){if(1==x){if(E){var x=w-0.01,k=B-z,o=B-E,x=a("path",{d:["M",w,k,"A",z,z,0,1,1,x,k,"L",x,o,"A",E,E,0,1,0,w,o].join(" ")})}else{x=a("circle",{cx:w,cy:B,r:z})}}else{k=q+F,o=["M"].concat(y(q,z),"A",z,z,0,0.5<x?1:0,1,y(k,z),"L"),E?o=o.concat(y(k,E),"A",E,E,0,0.5<x?1:0,0,y(q,E)):o.push(w,B),q+=F,x=a("path",{d:o.join(" ")})}x.attr("fill",H.call(this,F,C,D));v.append(x)}}});f.register("donut",c.extend(!0,{},f.defaults.pie),function(d){f.graphers.pie.call(this,d)});f.register("line",{delimiter:",",fill:"#c6d9fd",height:16,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(z){var y=this.values();1==y.length&&y.push(y[0]);for(var v=e.max.apply(e,z.max==l?y:y.concat(z.max)),x=e.min.apply(e,z.min==l?y:y.concat(z.min)),w=this.prepare(z.width,z.height),o=z.strokeWidth,u=w.width(),q=w.height()-o,p=v-x,v=this.x=function(d){return d*(u/(y.length-1))},h=this.y=function(k){var d=q;p&&(d-=(k-x)/p*q);return d+o/2},A=h(e.max(x,0)),t=[0,A],n=0;n<y.length;n++){t.push(v(n),h(y[n]))}t.push(u,A);z.fill&&w.append(a("polygon",{fill:z.fill,points:t.join(" ")}));o&&w.append(a("polyline",{fill:"none",points:t.slice(2,t.length-2).join(" "),stroke:z.stroke,"stroke-width":o,"stroke-linecap":"square"}))});f.register("bar",{delimiter:",",fill:["#4D89F9"],height:16,min:0,padding:0.1,width:32},function(J){for(var I=this.values(),F=e.max.apply(e,J.max==l?I:I.concat(J.max)),H=e.min.apply(e,J.min==l?I:I.concat(J.min)),G=this.prepare(J.width,J.height),z=G.width(),E=G.height(),B=F-H,J=J.padding,A=this.fill(),t=this.x=function(d){return d*z/I.length},q=this.y=function(d){return E-(B?(d-H)/B*E:1)},D=0;D<I.length;D++){var y=t(D+J),h=t(D+1-J)-y,C=I[D],v=q(C),x=v,w;B?0>C?x=q(e.min(F,0)):v=q(e.max(H,0)):w=1;w=v-x;0==w&&(w=1,0<F&&B&&x--);G.append(a("rect",{fill:A.call(this,C,D,I),x:y,y:x,width:h,height:w}))}})})(jQuery,document,Math);